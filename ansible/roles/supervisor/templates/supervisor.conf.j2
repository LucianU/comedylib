[program:uwsgi]
command = uwsgi --ini {{ uwsgi_config_file }}
autostart = true
autorestart = true
redirect_stderr = true
stopsignal = QUIT

{% if ENV != 'development' %}
[program:celeryd]
environment = DJANGO_SETTINGS_MODULE={{ django_settings_file }}
command = python {{ repo_root }}/manage.py celery worker --concurrency=2 --app=comedylib.celery.config -l info
autorestart = true
redirect_stderr = true
stdout_logfile = /var/log/celeryd.log
priority = 2

[program:celerybeat]
environment = DJANGO_SETTINGS_MODULE={{ django_settings_file }}
command = python {{ repo_root }}/manage.py celery beat --app=comedylib.celery.config --pidfile=/var/run/celerybeat.pid -s /var/run/celerybeat-schedule -l info
autorestart = true
redirect_stderr = true
stdout_logfile = /var/log/celerybeat.log
priority = 3
{% endif %}

[supervisord]
logfile = {{ project_log_path }}/supervisord.log
logfile_maxbytes = 10MB
logfile_backups = 5
loglevel = info
pidfile = {{ supervisor_pid_file }}
user = {{ app_user }}

[supervisorctl]
serverurl = unix://{{ supervisor_sock_file }}

[unix_http_server]
file = {{ supervisor_sock_file }}
chmod = 0777

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
